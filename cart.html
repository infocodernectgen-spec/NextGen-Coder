<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Your Cart ‚Ä¢ Gyan Bakery</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <header class="site-header">
    <div class="container header-wrap">
      <a class="logo" href="index.html"><span>Gyan Bakery</span></a>
      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="products.html">Products</a>
        <a href="cart.html" class="active">Cart <span id="cartBadge" class="badge" style="display:none;"></span></a>
        <a href="profile.html" class="btn primary">My Profile</a>
      </nav>
    </div>
  </header>

  <section class="container mt-4">
    <div class="flex justify-between items-center">
      <h1>Your Shopping Cart</h1>
      <a href="products.html" class="text-sm" style="color: var(--primary); font-weight: 600;">&larr; Continue Shopping</a>
    </div>
    
    <div class="grid-2 mt-4" style="grid-template-columns: 1.8fr 1.2fr; align-items: start;">
      <div id="cartItems">
        <!-- JS -->
      </div>
      
      <div class="summary-sidebar">
        <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow); position: sticky; top: 90px;">
          <h3 style="margin-bottom: 1.5rem;">Order Summary</h3>
          
          <div class="form-group">
            <label class="text-xs text-muted" style="text-transform: uppercase; letter-spacing: 0.05em;">Have a coupon?</label>
            <div class="input-group">
              <input type="text" id="couponCode" placeholder="Enter code (e.g. GYAN10)">
              <button class="btn primary sm" onclick="applyCoupon()">Apply</button>
            </div>
            <p id="couponMsg" class="text-xs mt-1" style="display:none;"></p>
          </div>

          <div class="checkout-details">
            <div class="form-group" style="margin-bottom: 1rem;">
              <label class="text-xs text-muted">DELIVERY SLOT</label>
              <select id="deliverySlot" class="form-select">
                <option value="Morning (9AM - 12PM)">Morning (9AM - 12PM)</option>
                <option value="Afternoon (12PM - 4PM)">Afternoon (12PM - 4PM)</option>
                <option value="Evening (4PM - 8PM)">Evening (4PM - 8PM)</option>
              </select>
            </div>
            <div class="form-group" style="margin-bottom: 0;">
              <label class="text-xs text-muted">SPECIAL INSTRUCTIONS</label>
              <textarea id="orderNote" class="form-select" rows="2" placeholder="e.g. Less sugar, Eggless, etc."></textarea>
            </div>
          </div>

          <div class="mt-4" style="border-top: 1px dashed #e2e8f0; padding-top: 1rem;">
            <div class="flex justify-between mt-2">
              <span class="text-muted">Subtotal</span>
              <span id="subtotal">‚Çπ0</span>
            </div>
            <div id="discountRow" class="flex justify-between mt-2" style="display:none; color: #10b981;">
              <span>Discount</span>
              <span id="discountVal">-‚Çπ0</span>
            </div>
            <div class="flex justify-between mt-2">
              <span class="text-muted">Delivery Fee</span>
              <span>‚Çπ40</span>
            </div>
            <hr style="border: 0; border-top: 1px solid #e2e8f0; margin: 1rem 0;">
            <div class="flex justify-between" style="font-weight: 700; font-size: 1.25rem; color: var(--text);">
              <span>Grand Total</span>
              <span id="total">‚Çπ0</span>
            </div>
          </div>
          
          <div class="mt-4">
            <button id="checkoutBtn" class="btn primary w-full" style="padding: 1rem; border-radius: 12px; font-size: 1rem;">Pay with Razorpay</button>
            <button id="walletPayBtn" class="btn outline w-full mt-2" style="border: 1px solid #e2e8f0; color: #64748b;">Pay with Wallet</button>
            <p id="walletInfo" class="text-xs text-muted mt-2 text-center"></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Mock Razorpay Modal -->
  <div id="razorpayModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
    <div style="background:white; width:400px; padding:20px; border-radius:8px;">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/89/Razorpay_logo.svg" style="height:30px;">
        <button onclick="document.getElementById('razorpayModal').style.display='none'" style="background:none; border:none; font-size:20px; cursor:pointer;">&times;</button>
      </div>
      <p class="text-muted">Paying to Gyan Bakery</p>
      <h2 id="payAmount">‚Çπ0</h2>
      
      <div style="margin-top:20px;">
        <p style="font-weight:600; margin-bottom:10px;">Select Payment Gateway</p>
        <div style="display:grid; gap:10px;">
          <button class="btn outline" onclick="simulatePayment('eSewa')" style="display:flex; align-items:center; justify-content:center; gap:10px; border-color:#41a124; color:#41a124;">
            <span style="font-weight:bold;">eSewa</span>
          </button>
          <button class="btn outline" onclick="simulatePayment('Khalti')" style="display:flex; align-items:center; justify-content:center; gap:10px; border-color:#5c2d91; color:#5c2d91;">
            <span style="font-weight:bold;">Khalti</span>
          </button>
          <button class="btn outline" onclick="simulatePayment('PhonePe')" style="display:flex; align-items:center; justify-content:center; gap:10px; border-color:#5f259f; color:#5f259f;">
            <span style="font-weight:bold;">PhonePe</span>
          </button>
          <button class="btn outline" onclick="simulatePayment('Razorpay')" style="display:flex; align-items:center; justify-content:center; gap:10px; border-color:#3395ff; color:#3395ff;">
            <span style="font-weight:bold;">Razorpay</span>
          </button>
        </div>
      </div>
      
      <button class="btn outline sm mt-4 w-full" onclick="document.getElementById('razorpayModal').style.display='none'">Cancel</button>
    </div>
  </div>

  <script src="assets/customer.js"></script>
  <script>
    const renderCart = () => {
      const cart = getCart();
      const container = document.getElementById("cartItems");
      
      const user = JSON.parse(localStorage.getItem("user"));
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const updatedUser = user ? (users.find(u => u.email === user.email) || user) : null;
      
      const currentWallet = updatedUser ? (updatedUser.wallet || 0) : 0;
      document.getElementById("walletInfo").textContent = updatedUser ? `Available Balance: ‚Çπ${currentWallet}` : "Login to use wallet";
      
      if (cart.length === 0) {
        container.innerHTML = "<p>Your cart is empty.</p>";
        document.getElementById("subtotal").textContent = "‚Çπ0";
        document.getElementById("total").textContent = "‚Çπ0";
        return;
      }
      
      container.innerHTML = cart.map((item, idx) => `
        <div style="display:flex; gap:1rem; margin-bottom:1rem; background:white; padding:1rem; border-radius:8px;">
          <img src="${item.image}" style="width:80px; height:80px; object-fit:cover; border-radius:6px;">
          <div style="flex:1;">
            <h4>${item.name}</h4>
            <p class="text-sm text-muted">${item.description || ''}</p>
            <div class="flex justify-between items-center mt-2">
              <span class="price">‚Çπ${item.price} x ${item.qty}</span>
              <button class="btn outline sm" onclick="removeFromCart(${idx})">Remove</button>
            </div>
          </div>
        </div>
      `).join("");
      
      const subtotal = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
      const total = subtotal + 40;
      document.getElementById("subtotal").textContent = `‚Çπ${subtotal}`;
      document.getElementById("total").textContent = `‚Çπ${total}`;
      document.getElementById("payAmount").textContent = `‚Çπ${total}`;

      const walletBtn = document.getElementById("walletPayBtn");
      if (!updatedUser) {
        walletBtn.disabled = true;
        walletBtn.title = "Please login to use wallet";
      } else if (currentWallet < total) {
        walletBtn.disabled = true;
        walletBtn.title = "Insufficient balance";
      } else {
        walletBtn.disabled = false;
        walletBtn.title = "";
      }
    };

    window.removeFromCart = (idx) => {
      const cart = getCart();
      cart.splice(idx, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartBadge();
      renderCart();
    };

    document.getElementById("checkoutBtn").addEventListener("click", () => {
      if (getCart().length === 0) return alert("Cart is empty!");
      document.getElementById("razorpayModal").style.display = "flex";
    });

    window.simulatePayment = (method) => {
      document.getElementById("razorpayModal").style.display = "none";
      alert(`Connecting to ${method}...`);
      setTimeout(() => {
        placeOrder(method);
      }, 1000);
    };

    document.getElementById("walletPayBtn").addEventListener("click", () => {
      const cart = getCart();
      const subtotal = cart.reduce((acc, item) => acc + (item.price * item.qty), 0);
      const total = subtotal + 40;
      
      const user = JSON.parse(localStorage.getItem("user"));
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const userIdx = users.findIndex(u => u.email === user.email);
      
      if (userIdx >= 0 && (users[userIdx].wallet || 0) >= total) {
        users[userIdx].wallet -= total;
        localStorage.setItem("users", JSON.stringify(users));
        placeOrder("Wallet");
      } else {
        alert("Insufficient balance or user not found!");
      }
    });

    function placeOrder(method) {
      const cart = getCart();
      const total = document.getElementById("total").textContent;
      const user = JSON.parse(localStorage.getItem("user"));
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const loggedUser = users.find(u => u.email === (user ? user.email : ""));
      
      // Create Order
      const orders = JSON.parse(localStorage.getItem("orders") || "[]");
      const newOrder = {
        id: "ORD" + Date.now().toString().slice(-6),
        date: new Date().toLocaleString(),
        customerName: user ? user.name : "Guest",
        customerEmail: user ? user.email : "N/A",
        customerPhone: loggedUser ? loggedUser.phone : "N/A",
        customerAddress: loggedUser ? loggedUser.address : "N/A",
        items: cart,
        total: total,
        status: "Received",
        payment: method
      };
      orders.unshift(newOrder);
      localStorage.setItem("orders", JSON.stringify(orders));
      
      // Clear Cart
      localStorage.setItem("cart", "[]");
      
      alert(`Order placed successfully via ${method}!`);
      window.location.href = "profile.html";
    }

    renderCart();
  </script>

  <footer>
    <div class="container footer-grid">
      <div>
        <div class="footer-logo">üéÇ Gyan Bakery</div>
        <p>Baking memories since 2010. 100% artisanal, eggless options available.</p>
        <div class="social-links">
          <a href="#" title="Facebook">f</a>
          <a href="#" title="Instagram">ig</a>
          <a href="#" title="Twitter">x</a>
          <a href="#" title="YouTube">yt</a>
        </div>
      </div>
      <div>
        <h3>Quick Links</h3>
        <p><a href="track-order.html">üì¶ Track Order</a></p>
        <p><a href="profile.html">üë§ My Account</a></p>
        <p><a href="products.html">üõçÔ∏è Shop Now</a></p>
      </div>
      <div>
        <h3>Contact & Hours</h3>
        <p>üìç 123 Baker Street, Food City</p>
        <p>üìû +91 98765 43210</p>
        <p>‚úâÔ∏è hello@gyanbakery.com</p>
        <p style="margin-top: 1rem; color: #fff; font-size: 0.9rem; opacity: 0.8;">Mon-Sun: 9AM - 9PM</p>
      </div>
    </div>
    
    <div class="container footer-bottom">
      <p>
        <a href="#">Privacy Policy</a> | 
        <a href="#">Terms of Service</a> | 
        <a href="#">Refund Policy</a>
      </p>
      <p style="margin-top: 1rem; opacity: 0.6;">¬© 2026 Gyan Bakery. All rights reserved. ‚ù§Ô∏è</p>
    </div>
  </footer>
</body>
</html>
